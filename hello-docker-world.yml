---
- hosts: all
  tasks:
    - name: pull image
      docker_container:
        name: hello-docker-world
        image: lolspider/hello-docker-world:{{ version }}
        log_driver: fluentd
        log_options:
          fluentd-address: localhost:24224
          tag: "{{ docker_tag }}:lolspider/hello-docker-world:{{ version }}"
        ports:
          - "{{ host_port }}:{{ exposed_port }}"
        state: started

    - name: check if web can be access
      uri:
        url: http://{{ ansible_hostname }}:{{ host_port }}
      register: result
      until: (result.status == 200)
      retries: "{{ web_connection_retries }}"
      delay: "{{ web_connection_delay }}"
