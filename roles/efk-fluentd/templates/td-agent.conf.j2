
# Receive data from port {{ fluentd_port }}
<source>
  @type forward
  @label @log_handler
  port {{ fluentd_port }}
  bind 0.0.0.0
</source>

<label @log_handler>

  #reparse record log with expression,for example:
  #old log:  {"log":"Hello World"}
  #new log:  {"log":"Hello World"}
  <filter>
    @type parser
    key_name log
    reserve_data true
    <parse>
      @type regexp
      expression {{ fluentd_parser }}
    </parse>
  </filter>

  #remove unnecessary keys and add importment keys
  <filter>
    @type record_transformer
    remove_keys source,container_id
    <record>
      tag ${tag}
      timestamp ${time}
    </record>
  </filter>

  #forward log
  <match **>
    @type forward
    <server>
      name master
      host {{ fluentd_server }}
    </server>
    <server>
      name backup
      host {{ fluentd_server_bak | default(omit) }}
      standby
    </server>
  </match>
</label>
